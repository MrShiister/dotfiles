{{- if eq .chezmoi.osRelease.id "ubuntu" "debian" -}}
#!/bin/sh

# Add chezmoi completions
mkdir -p $HOME/.oh-my-zsh/completions/
chezmoi completion zsh > $HOME/.oh-my-zsh/completions/_chezmoi

packages="tmux fd-find ripgrep"
{{ if not .is_devcontainer -}}
packages="${packages} git zsh"
{{- end }}

{{ if .get_gh_cli -}}
# Add official GitHub repo source
(type -p wget >/dev/null || ({{ .sudo }}apt update && {{ .sudo }}apt-get install wget -y)) \
&& {{ .sudo }}mkdir -p -m 755 /etc/apt/keyrings \
&& wget -qO- https://cli.github.com/packages/githubcli-archive-keyring.gpg | {{ .sudo }}tee /etc/apt/keyrings/githubcli-archive-keyring.gpg > /dev/null \
&& {{ .sudo }}chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg \
&& echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | {{ .sudo }}tee /etc/apt/sources.list.d/github-cli.list > /dev/null
packages="${packages} gh"
{{ .sudo }}chown $USER:$USER $HOME/.gnupg $HOME/.config/gh
{{- end }}

{{ .sudo }}apt update
echo "Installing ${packages}"
{{ .sudo }}apt install -y ${packages}

{{ if .get_devcontainer_cli -}}
curl -fsSL https://deb.nodesource.com/setup_22.x | {{ .sudo }}bash -
{{ .sudo }}apt install -y nodejs

# install devcontainers cli
echo "Installing devcontainers cli"
{{ .sudo }}npm install -g @devcontainers/cli
{{- end }}

# Install nvim
echo "Installing nvim latest"
curl -LO https://github.com/neovim/neovim/releases/latest/download/nvim-linux64.tar.gz
{{ .sudo }}tar -C /usr/local/ -xzf nvim-linux64.tar.gz --strip-components=1

# Install lazygit
echo "Installing lazygit"
LAZYGIT_VERSION=$(curl -s "https://api.github.com/repos/jesseduffield/lazygit/releases/latest" | grep -Po '"tag_name": "v\K[^"]*')
echo "Lazygit version $LAZYGIT_VERSION"
curl -Lo lazygit.tar.gz "https://github.com/jesseduffield/lazygit/releases/latest/download/lazygit_${LAZYGIT_VERSION}_Linux_x86_64.tar.gz"
tar xf lazygit.tar.gz lazygit
{{ .sudo }}install lazygit /usr/local/bin
rm lazygit.tar.gz
{{ end }}
